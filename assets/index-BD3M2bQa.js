(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const r=document.getElementById("scanButton"),c=document.getElementById("statusIcon"),L=document.getElementById("log"),l=c.querySelector("svg"),d=document.getElementById("registerSection"),v=document.getElementById("nameInput"),y=document.getElementById("saveButton"),h=document.getElementById("cancelButton"),I=document.getElementById("toggleUsersBtn"),u=document.getElementById("userListSection");let p=null;const S='<path stroke-linecap="round" stroke-linejoin="round" d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />',E='<path stroke-linecap="round" stroke-linejoin="round" d="M9.348 14.651a3.75 3.75 0 010-5.303m5.304 0a3.75 3.75 0 010 5.303m-7.425 2.122a6.75 6.75 0 010-9.546m9.546 0a6.75 6.75 0 010 9.546M5.106 18.894c-3.808-3.808-3.808-9.98 0-13.788m13.788 0c3.808 3.808 3.808 9.98 0 13.788M12 12h.008v.008H12V12z" />',b='<path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />',M='<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />',N='<path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm9 5.25h.008v.008H12v-.008z" />';function m(){const e=localStorage.getItem("nfc_users");return e?JSON.parse(e):{}}function O(e,t){const a=m();a[e]={name:t,timestamp:new Date().toISOString()},localStorage.setItem("nfc_users",JSON.stringify(a)),g()}function B(e){const t=m();delete t[e],localStorage.setItem("nfc_users",JSON.stringify(t)),g()}function g(){const e=m();if(u.innerHTML="",Object.keys(e).length===0){u.innerHTML="<p style='color: var(--text-muted); padding: 10px;'>No registered users.</p>";return}Object.entries(e).forEach(([t,a])=>{const i=document.createElement("div");i.className="user-item",i.innerHTML=`
      <span><b>${a.name}</b> <br><small style='color: #9ca3af'>${t.slice(0,8)}...</small></span>
      <button class="delete-btn" onclick="window.removeUser('${t}')">Remove</button>
    `,u.appendChild(i)})}window.removeUser=e=>{confirm("Are you sure you want to remove this user?")&&B(e)};function o(e,t){L.classList.remove("hidden"),L.innerHTML=t,c.className="status-icon",e==="scanning"?(c.classList.add("scanning"),l.innerHTML=E,r.disabled=!0,r.textContent="Scanning...",d.classList.add("hidden")):e==="success"?(c.classList.add("success"),l.innerHTML=b,r.disabled=!1,r.textContent="Scan Again",navigator.vibrate&&navigator.vibrate(200)):e==="unknown"?(c.classList.add("error"),l.innerHTML=N,r.disabled=!1,r.textContent="Scan Again",navigator.vibrate&&navigator.vibrate([100,50,100])):e==="error"?(c.classList.add("error"),l.innerHTML=M,r.disabled=!1,r.textContent="Retry",navigator.vibrate&&navigator.vibrate([100,50,100])):(l.innerHTML=S,r.disabled=!1,r.textContent="Start Scan")}function w(e){p=e;const t=m();t[e]?(o("success",`Access Granted<br><strong style="font-size: 1.2rem; color: var(--primary-color)">${t[e].name}</strong>`),d.classList.add("hidden")):(o("unknown",`Unknown Card<br><small>ID: ${e}</small>`),d.classList.remove("hidden"),v.value="",v.focus())}r.addEventListener("click",async()=>{o("scanning","Hold device near card..."),d.classList.add("hidden");try{if(!("NDEFReader"in window))throw new Error("NFC not supported on this device.");const e=new NDEFReader;await e.scan(),e.addEventListener("readingerror",()=>{o("error","Read failed. Try again.")}),e.addEventListener("reading",({serialNumber:t})=>{console.log("Reading:",t),w(t)})}catch(e){o("error",e.message)}});y.addEventListener("click",()=>{const e=v.value.trim();if(!e){alert("Please enter a name");return}if(!p){alert("No card ID found. Please scan again.");return}O(p,e),o("success",`User Registered!<br><strong>${e}</strong>`),d.classList.add("hidden")});h.addEventListener("click",()=>{d.classList.add("hidden"),o("idle","Ready to scan")});I.addEventListener("click",()=>{u.classList.toggle("hidden"),g()});g();
